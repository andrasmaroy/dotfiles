#!/bin/bash
#
# Change commit author depending on origin url
# Originally from @mmorearty
# http://stackoverflow.com/a/13752961

set -euo pipefail

# "Real" git is the second one returned by 'which'
# REAL_GIT=$(which -a git | sed -n 2p)
if [ -x /usr/local/bin/git ]; then
  REAL_GIT='/usr/local/bin/git'
else
  REAL_GIT='/usr/bin/git'
fi

GIT_PRIVATE_REMOTE_REGEX=''
if [ -f ~/.dotoverrides/git-remotes ]; then
  source ~/.dotoverrides/git-remotes
fi

# Does the remote "origin" point a private repo
if "$REAL_GIT" remote get-url origin 2> /dev/null | grep -qsE "${GIT_PRIVATE_REMOTE_REGEX}" \
  && [ -f ~/.dotoverrides/git ]; then
    # Yes, change username and email
    source ~/.dotoverrides/git
fi

"$REAL_GIT" "$@"
